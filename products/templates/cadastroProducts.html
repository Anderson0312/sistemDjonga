{% load static %}

{% include 'templatebase/navbar.html' %}
<style>
  #formulario-cadastro {
      display: block;
  }

  #formulario-edicao {
      display: none;
  }
</style>

<br>

<main class="form-signin w-100 m-auto">
  <div id="formulario-cadastro">
    <form method="post" action="{% url 'cadastroProducts' %}" >
      {% csrf_token %}
      <a class="nav-link d-flex align-items-center gap-2" href="/plataforma/index">
        <img class="mb-4" src="{% static '/brand/bootstrap-logo.svg' %}" alt="" width="72" height="57">
      </a>
      <h1 class="h3 mb-3 fw-normal">Cadastro de produto</h1>
  
      {% if messages %}
      {% for message in messages %}
          <div class="alert alert-success">
              {{ message }}
          </div>
      {% endfor %}
      {% endif %}
  
      <div class="form-floating">
        <input type="nameProd" name="nameProd" class="form-control" id="nameProd" placeholder="name product">
        <label for="floatingInput">Nome do produto</label>
      </div>
  
      <div class="form-floating mt-2">
        <input type="valor" name="valor" class="form-control" id="id_valor" placeholder="10,56">
        <label for="floatingInput">Valor</label>
      </div>
      <div class="form-floating mt-2">
        <input type="description" name="description" class="form-control" id="id_description" placeholder="description">
        <label for="floatingInput">description</label>
      </div>

      <div class="form-floating mt-2">
        <input type="category" name="category" class="form-control" id="id_category" placeholder="category">
        <label for="floatingInput">categoria</label>
      </div>
  
      <button class="btn btn-success w-100 py-2 mt-2" type="submit" >Cadastrar</button>
    </form>
  </div>

  <div id="formulario-edicao" >
    <form method="post" action="" id="edicaoForm">
      {% csrf_token %}
      <a class="nav-link d-flex align-items-center gap-2" href="/plataforma/index">
        <img class="mb-4" src="{% static '/brand/bootstrap-logo.svg' %}" alt="" width="72" height="57">
      </a>
      <h1 class="h3 mb-3 fw-normal">Edição de produto</h1>
    
      <div class="form-floating" >
        <input  type="id" name="id" class="form-control" id="productId"  disabled="">
        <label for="floatingInput">ID</label>
      </div>
      <div class="form-floating">
        <input type="name" name="name" class="form-control" id="name" placeholder="name product" required>
        <label for="floatingInput">Nome do produto</label>
        <div class="invalid-feedback">
          Por favor, preencha este campo.
      </div>
      </div>
  
      <div class="form-floating mt-2">
        <input type="valor" name="valor" class="form-control" id="id_valor" placeholder="10,56" required>
        <label for="floatingInput">Valor</label>
        <div class="invalid-feedback">
          Por favor, preencha este campo.
      </div>
      </div>
      <div class="form-floating mt-2">
        <input type="description" name="description" class="form-control" id="id_description" placeholder="description" required>
        <label for="floatingInput">description</label>
        <div class="invalid-feedback">
          Por favor, preencha este campo.
      </div>
      </div>

      <div class="form-floating mt-2">
        <input type="category" name="category" class="form-control" id="id_category" placeholder="category" required>
        <label for="floatingInput">categoria</label>
        <div class="invalid-feedback">
          Por favor, preencha este campo.
      </div>
      </div>
      <button class="btn btn-primary w-100 py-2 mt-2" type="submit" >Editar</button>
      <button type="button" class="btn w-100 py-2 mt-2 btn-success" onclick="mostrarFormularioCadastro()">Cadastrar Produto</button>
    </form>
  </div>


    <br>


    <h2 class="fw-normal">Products</h2>
  
    <div class="table-responsive small">
        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th scope="col">ID</th>
                    <th scope="col">Name Product</th>
                    <th scope="col">Valor</th>
                    <th scope="col">Description</th>
                    <th scope="col">Category</th>
                    <th scope="col">Function</th>
                </tr>
            </thead>
            <tbody>
              {% for product in mProducts %}
                <tr>
                    <td scope="row">{{ product.id }}</td>
                    <td>{{ product.name }}</td>
                    <td>{{ product.valor }}</td>
                    <td>{{ product.description }}</td>
                    <td>{{ product.category }}</td>
                    <td>
                        <button data-product-id="{{ product.id }}" type="button" class="btn btn-danger"
                                data-bs-toggle="modal" data-bs-target="#confirmDeleteModal{{ product.id }}">
                            Deletar
                        </button>
                        ou 
                        <button data-product-id="{{ product.id }}" type="button"  class="btn btn-warning" onclick="mostrarFormularioEdicao()">Editar Produto</button>
                    </td>
                </tr>
                <form method="post" action="{% url 'produto_delete' product.id %}">
                  {% csrf_token %}
                  <div class="modal fade" id="confirmDeleteModal{{ product.id }}" tabindex="-1"
                       aria-labelledby="exampleModalLabel" aria-hidden="true">
                      <div class="modal-dialog">
                          <div class="modal-content">
                              <div class="modal-header">
                                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                              </div>
                              <div class="modal-body">
                                  <h2>Tem certeza que deseja deletar o produto "{{ product.name }}"?</h2>
                              </div>
                              <div class="modal-footer">
                                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                  <button type="submit" class="btn btn-primary">Confirmar</button>
                              </div>
                          </div>
                      </div>
                  </div>
              </form>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    
    
    
    <br>
    <br>

  <!-- {% include 'buscar_produto.html' %}

  {% include 'resultado_busca.html' %} -->

<br>



  </main>

<script>
    document.getElementById('linkSubmit').addEventListener('click', function(event) {
        event.preventDefault(); // Evita o comportamento padrão do link
        document.getElementById('meuFormulario').submit(); // Submete o formulário
    });

    function mostrarFormularioEdicao() {
        const formularioCadastro = document.getElementById('formulario-cadastro');
        const formularioEdicao = document.getElementById('formulario-edicao');
        
        // Mostrar formulário de edição e ocultar formulário de cadastro
        formularioEdicao.style.display = 'block';
        formularioCadastro.style.display = 'none';

            // Obtém o ID do produto do botão clicado
        const productId = event.target.getAttribute('data-product-id');

        document.getElementById('productId').value = productId

        // Construa a URL com o valor de productId
        var url = "{% url 'editar_produto' %}" + productId + '/';

        // Defina a URL como a ação do formulário
        document.getElementById('edicaoForm').action = url;

    }

    function mostrarFormularioCadastro() {
        const formularioCadastro = document.getElementById('formulario-cadastro');
        const formularioEdicao = document.getElementById('formulario-edicao');

        // Mostrar formulário de cadastro e ocultar formulário de edição
        formularioCadastro.style.display = 'block';
        formularioEdicao.style.display = 'none';
    }

    // Espera o carregamento do DOM
    document.addEventListener('DOMContentLoaded', function () {
        // Captura o formulário
        var form = document.getElementById('myForm');

        // Adiciona um event listener para o envio do formulário
        form.addEventListener('submit', function (event) {
            // Captura o campo
            var campo = document.getElementById('campo');

            // Verifica se o campo está preenchido
            if (!campo.value) {
                // Se não estiver preenchido, previne o envio do formulário
                event.preventDefault();
                // Adiciona classes do Bootstrap para indicar campo inválido
                campo.classList.add('is-invalid');
            }
        });
    });

    
</script>


{% include 'templatebase/footer.html' %}


