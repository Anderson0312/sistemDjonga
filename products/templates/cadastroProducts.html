{% load static %}

{% include 'templatebase/navbar.html' %}

<br>

<main class="form-signin w-100 m-auto">
    <form method="post" action="{% url 'cadastroProducts' %}">
      {% csrf_token %}
      <a class="nav-link d-flex align-items-center gap-2" href="/plataforma/index">
        <img class="mb-4" src="{% static '/brand/bootstrap-logo.svg' %}" alt="" width="72" height="57">
      </a>
      <h1 class="h3 mb-3 fw-normal">Cadastro de produto</h1>
  
      {% if messages %}
      {% for message in messages %}
          <div class="alert alert-success">
              {{ message }}
          </div>
      {% endfor %}
      {% endif %}
  
      <div class="form-floating">
        <input type="nameProd" name="nameProd" class="form-control" id="nameProd" placeholder="name product">
        <label for="floatingInput">Nome do produto</label>
      </div>
  
      <div class="form-floating mt-2">
        <input type="valor" name="valor" class="form-control" id="id_valor" placeholder="10,56">
        <label for="floatingInput">Valor</label>
      </div>
      <div class="form-floating mt-2">
        <input type="description" name="description" class="form-control" id="id_description" placeholder="description">
        <label for="floatingInput">description</label>
      </div>

      <div class="form-floating mt-2">
        <input type="category" name="category" class="form-control" id="id_category" placeholder="category">
        <label for="floatingInput">categoria</label>
      </div>
  
      <button class="btn btn-primary w-100 py-2 mt-2" type="submit" >Cadastrar</button>
    </form>

    <br>
   
    <h2>Products</h2>
    {% for x in mProducts %}
    <div class="table-responsive small">
      <table class="table table-striped table-sm">
        <thead>
          <tr>
            <th scope="col">ID</th>
            <th scope="col">Name Product</th>
            <th scope="col">Valor</th>
            <th scope="col">description</th>
            <th scope="col">category</th>
            <th scope="col">funçaõ</th>
          </tr>
        </thead>
        
        <tbody>
          <tr>
            <td scope="row">{{x.id}}</td>
            <td >{{x.name}}</td>
            <td >{{x.valor}}</td>
            <td >{{x.description}}</td>
            <td >{{x.category}}</td>
            <td>
              <button href="{% url 'produto_delete' x.id %}" type="button" class="btn btn-primary" data-target="#confirmDeleteModal" data-bs-toggle="modal" data-bs-target="#exampleModal">
                Deletar
              </button>
            ou E</td>
          </tr>
        </tbody>
      </table>
    </div>
    

    <form method="post" action="{% url 'produto_delete' x.id %}">
      {% csrf_token %}

    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="exampleModalLabel">Modal title</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h2>Tem certeza que deseja deletar o produto "{{ x.id}}"?</h2>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="submit" class="btn btn-primary">Confirmar</button>
            </div>
          </div>
        </div>
      </div>
    
    </form>

    {% endfor %}

{% include 'buscar_produto.html' %}

{% include 'resultado_busca.html' %}

<br>



  </main>

<script>
    document.getElementById('linkSubmit').addEventListener('click', function(event) {
        event.preventDefault(); // Evita o comportamento padrão do link
        document.getElementById('meuFormulario').submit(); // Submete o formulário
    });

    document.addEventListener("DOMContentLoaded", function() {
    const confirmDeleteBtn = document.getElementById("confirmDeleteBtn");

    confirmDeleteBtn.addEventListener("click", function() {
        // Obtenha o ID do produto do botão (supondo que você esteja usando Django para renderizar o template)
        const productId = {{ x.id }};

        // Envie uma solicitação POST para a URL de deleção
        fetch(`/produto/${productId}/delete/`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": "{{ csrf_token }}"
            },
            body: JSON.stringify({
                "csrfmiddlewaretoken": "{{ csrf_token }}"
            })
        })
        .then(response => response.json())
        .then(data => {
            // Redirecione para a página de listagem de produtos ou faça outra coisa
            window.location.href = "{% url 'viewProducts' %}";
        })
        .catch(error => {
            console.error("Erro ao deletar o produto:", error);
        });
      });
    });
    
</script>


{% include 'templatebase/footer.html' %}


